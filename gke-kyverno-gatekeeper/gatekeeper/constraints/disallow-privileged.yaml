# Gatekeeper Constraints: Disallow Privileged Containers
# These constraints use the security-related templates

apiVersion: constraints.gatekeeper.sh/v1beta1
kind: K8sPSPPrivilegedContainer
metadata:
  name: disallow-privileged-containers
  annotations:
    description: "Disallows containers from running in privileged mode"
spec:
  enforcementAction: deny
  match:
    kinds:
      - apiGroups: [""]
        kinds: ["Pod"]
    namespaces:
      - gatekeeper-demo
      - apps
    excludedNamespaces:
      - kube-system
      - kube-public
      - gatekeeper-system
  parameters:
    exemptImages: []

---
apiVersion: constraints.gatekeeper.sh/v1beta1
kind: K8sPSPAllowPrivilegeEscalationContainer
metadata:
  name: disallow-privilege-escalation
  annotations:
    description: "Disallows privilege escalation in containers"
spec:
  enforcementAction: deny
  match:
    kinds:
      - apiGroups: [""]
        kinds: ["Pod"]
    namespaces:
      - gatekeeper-demo
      - apps
    excludedNamespaces:
      - kube-system
      - kube-public
      - gatekeeper-system
  parameters:
    exemptImages: []

---
apiVersion: constraints.gatekeeper.sh/v1beta1
kind: K8sPSPRunAsNonRoot
metadata:
  name: require-run-as-non-root
  annotations:
    description: "Requires containers to run as non-root user"
spec:
  enforcementAction: deny
  match:
    kinds:
      - apiGroups: [""]
        kinds: ["Pod"]
    namespaces:
      - gatekeeper-demo
      - apps
    excludedNamespaces:
      - kube-system
      - kube-public
      - gatekeeper-system
  parameters:
    exemptImages: []